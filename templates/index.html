<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileTools Web</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/translations/lang.js" defer></script>
</head>
<body>
    <div class="container">
        <div id="language-switcher">
            <label for="language"><span id="language_label">üåê Language</span></label>
            <select id="language"></select>
        </div>

        <h1 id="page_title">File Converter</h1>

        <!-- Step 1: File Selection -->
        <div class="step-section active" id="step-1">
            <label for="inputType" id="choose_input_type">Choose input type:</label>
            <select id="inputType">
                <option value="files">üîò <span id="select_input_files">Select Files</span></option>
                <option value="folder">üìÅ <span id="select_input_folder">Select Folder</span></option>
            </select>

            <label id="select_files_label">Select files to convert</label>
            <input type="file" id="inputFiles" multiple>

            <label id="select_folder_label" style="display:none;">Select folder to convert</label>
            <input type="file" id="inputFolder" webkitdirectory directory style="display:none;">

            <div class="step-buttons">
                <button type="button" onclick="nextStep(2)" id="next_button_step1">Next</button>
            </div>
        </div>

        <!-- Step 2: Output Format -->
        <div class="step-section" id="step-2">
            <label for="outputFormats" id="select_formats">Select output formats:</label>
            <select id="outputFormats" multiple>
                <option value="pdf">PDF</option>
                <option value="txt">TXT</option>
                <option value="html">HTML</option>
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
            </select>

            <label for="outputDir" id="select_output">Select output directory</label>
            <input type="file" id="outputDir" webkitdirectory directory>

            <div>
                <input type="checkbox" id="mergePDF">
                <label for="mergePDF" id="merge_option">üóÉÔ∏è Merge PDF files into one</label>
            </div>

            <div class="step-buttons">
                <button type="button" onclick="prevStep(1)" id="back_button_step2">Back</button>
                <button type="button" onclick="nextStep(3)" id="next_button_step2">Next</button>
            </div>
        </div>

        <!-- Step 3: Summary & Start -->
        <div class="step-section" id="step-3">
            <div id="summary-box">
                <h5 id="summary_title">Summary:</h5>
                <div id="summary-content"></div>
            </div>

            <div class="progress" id="progressBarWrapper" style="display:none;">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>

            <div class="step-buttons">
                <button type="button" onclick="prevStep(2)" id="back_button_step3">Back</button>
                <button type="button" onclick="startConversion()" id="start_conversion">üöÄ Start Conversion</button>
            </div>
        </div>

        <div class="footer">
            <p id="created_by">v2.1 | Created by Yoavs5771</p>
        </div>
    </div>

    <script>
        let currentStep = 1;

        function showStep(step) {
            document.querySelectorAll('.step-section').forEach(section => section.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
        }

        function nextStep(step) {
            updateSummary();
            currentStep = step;
            showStep(step);
        }

        function prevStep(step) {
            currentStep = step;
            showStep(step);
        }

        document.getElementById('inputType').addEventListener('change', function () {
            if (this.value === 'folder') {
                document.getElementById('inputFolder').style.display = 'block';
                document.getElementById('inputFiles').style.display = 'none';
                document.getElementById('select_folder_label').style.display = 'block';
                document.getElementById('select_files_label').style.display = 'none';
            } else {
                document.getElementById('inputFolder').style.display = 'none';
                document.getElementById('inputFiles').style.display = 'block';
                document.getElementById('select_folder_label').style.display = 'none';
                document.getElementById('select_files_label').style.display = 'block';
            }
        });

        function updateSummary() {
            const files = document.getElementById('inputFiles').files;
            const folder = document.getElementById('inputFolder').files;
            const outputFormats = Array.from(document.getElementById('outputFormats').selectedOptions).map(opt => opt.value).join(', ');
            const merge = document.getElementById('mergePDF').checked ? 'Yes' : 'No';

            let fileSummary = files.length ? `${files.length} files selected.` : folder.length ? `${folder.length} files in folder.` : 'No files selected.';

            document.getElementById('summary-content').innerHTML = `
                <p><strong>Files:</strong> ${fileSummary}</p>
                <p><strong>Output formats:</strong> ${outputFormats}</p>
                <p><strong>Merge PDFs:</strong> ${merge}</p>
            `;
        }
    </script>
</body>
</html>
